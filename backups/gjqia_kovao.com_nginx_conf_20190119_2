# -----------------------------------------------
#
# HTTP SERVER
#
# -----------------------------------------------

server {
    listen      80;
    server_name kovao.com;
    return      301 https://www.kovao.com$request_uri;
} 

server {
    listen      80;
    server_name *.kovao.com;
    return      301 https://$host$request_uri;
}

# -----------------------------------------------
#
# HTTPS SECURE SERVER
#
# -----------------------------------------------

#
# KOVAO.COM
#
server {
    listen       443 ssl;
    server_name  kovao.com;
    return      301 https://www.kovao.com$request_uri;
} 

#
# WWW.KOVAO.COM
#
server {
        listen 443 ssl;
        server_name www.kovao.com;

        access_log /var/www/kovao.com/logs/main.access.log;
        error_log /var/www/kovao.com/logs/main.error.log;
        root /var/www/kovao.com/main/public;

        index index.php index.html;

        ssl_certificate /etc/letsencrypt/live/kovao.com-0001/fullchain.pem;
        ssl_certificate_key /etc/letsencrypt/live/kovao.com-0001/privkey.pem;
        ssl_trusted_certificate /etc/letsencrypt/live/kovao.com-0001/fullchain.pem;
        include /etc/nginx/snippets/ssl-params.conf;

        # set expiration of assets to MAX for caching
        location ~* \.(ico|css|js|gif|jpe?g|png)(\?[0-9]+)?$ {
                expires max;
                log_not_found off;
        }

        location / {
                try_files $uri $uri/ /index.php;
        }

        location ~ \.php$ {
            include snippets/fastcgi-php.conf;
            fastcgi_pass unix:/run/php/php7.0-fpm.sock;
        }
}

#
# DEV.KOVAO.COM
#
server {
        listen 443 ssl;
        server_name dev.kovao.com;

        access_log /var/www/kovao.com/logs/dev.access.log;
        error_log /var/www/kovao.com/logs/dev.error.log;
        root /var/www/kovao.com/dev/public;

        index index.php index_maintenance.php index.html;

        ssl_certificate /etc/letsencrypt/live/kovao.com-0001/fullchain.pem;
        ssl_certificate_key /etc/letsencrypt/live/kovao.com-0001/privkey.pem;
        ssl_trusted_certificate /etc/letsencrypt/live/kovao.com-0001/fullchain.pem;
        include snippets/ssl-params.conf;

        # set expiration of assets to MAX for caching
        location ~* \.(ico|css|js|gif|jpe?g|png)(\?[0-9]+)?$ {
                expires max;
                log_not_found off;
        }

        location / {
                try_files $uri $uri/ /index.php;
        }

        location ~ \.php$ {
            include snippets/fastcgi-php.conf;
            fastcgi_param CI_ENV 'development';
            fastcgi_pass unix:/run/php/php7.0-fpm.sock;
        }
}

#
# (SUBDOMAINS).KOVAO.COM
#
server {
    listen 443 ssl;
    server_name *.kovao.com;

    access_log /var/www/kovao.com/logs/www.access.log;
    error_log /var/www/kovao.com/logs/www.error.log;
    root /var/www/kovao.com/evaluations/public;

    index index.php index_maintenance.php index.html;

    ssl_certificate /etc/letsencrypt/live/kovao.com-0001/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/kovao.com-0001/privkey.pem;
    ssl_trusted_certificate /etc/letsencrypt/live/kovao.com-0001/fullchain.pem;
    include /etc/nginx/snippets/ssl-params.conf;


    # set expiration of assets to MAX for caching
    location ~* \.(ico|css|js|gif|jpe?g|png)(\?[0-9]+)?$ {
            expires max;
            log_not_found off;
    }

    location / {
            try_files $uri $uri/ /index.php;
    }

    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        fastcgi_param CI_ENV 'production';
        fastcgi_pass unix:/run/php/php7.0-fpm.sock;
    }
}

